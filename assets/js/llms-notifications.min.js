!function(t){var i=function(){function i(){t("body").on("click",".llms-notification-dismiss",function(){l.dismiss(t(this).closest(".llms-notification"))})}function n(i){t.map(d,function(t){i==t.id}),d.push({id:i,status:"read"})}function e(i){var n=null;t.map(d,function(t,e){if(i==t.id)return void(n=e)}),null!==n&&d.splice(n,1)}function s(){clearInterval(r)}function o(){pump(function(){l.restart_heartbeat&&(l.restart_heartbeat=!1,a()),l.block_ajax=!1,l.has_notifications&&l.show_all()})}function a(){r=setInterval(o,f)}var r,l=this,u=window.llms&&window.llms.notification_settings?window.llms.notification_settings:{},c=u.heartbeat_delay?u.heartbeat_delay:0,f=u.heartbeat_interval?u.heartbeat_interval:3e4,h=[],d=[];return pump=function(t){return l.block_ajax?(l.restart_heartbeat=!0,s(),t()):(l.block_ajax=!0,void(d.length?update(function(){retrieve(function(){t()})}):retrieve(function(){t()})))},retrieve=function(t){LLMS.Ajax.call({llms_rest:!0,llms_rest_endpoint:"notifications",type:"GET",data:{per_page:5,status:"new",subscriber:"self",type:"basic"},success:function(i,n,e){"success"===n&&i.length?(l.queue(i),l.empties=0):(l.empties++,0===l.empties%3&&(f+=f/2,l.restart_heartbeat=!0,s())),t()}})},update=function(i){LLMS.Ajax.call({llms_rest:!0,llms_rest_endpoint:"notifications/batch",type:"PUT",data:{update:d},success:function(n,s,o){t.each(n.update,function(t,i){e(i.id)}),i&&i()}})},this.block_ajax=!1,this.restart_heartbeat=!1,this.empties=0,this.init=function(){this.is_user_logged_in()&&(window.onbeforeunload=function(){d.length&&update()},i(),setTimeout(function(){o(),setTimeout(function(){a()},c)},c))},this.queue=function(t){var i=this;for(var n in t)t.hasOwnProperty(n)&&!1===i.notification_exists(t[n].id)&&h.push(t[n])},this.dismiss=function(t){var i=this;t.removeClass("visible"),n(t.attr("data-id")),setTimeout(function(){i.reposition(t.next(".llms-notification.visible"))},10)},this.notification_exists=function(t){for(var i in h)if(h.hasOwnProperty(i)&&t===h[i].id)return i;return!1},this.get_offset=function(i){var n=12;if(i||(i=t(".llms-notification.visible").last()),!i.offset())return 24;var e=i.offset().top,s=i.outerHeight();return e+s+n},this.has_notifications=function(){return h.length},this.is_user_logged_in=function(){return t("body").hasClass("logged-in")},this.reposition=function(i){var n,e=this,s=".llms-notification.visible";i.length||(i=t(s).first()),i.css("top",e.get_offset(i.prevAll(s).first())),n=i.next(s),n.length&&setTimeout(function(){e.reposition(n)},150)},this.show_all=function(){var t,i=this,n=0;t=setInterval(function(){n<h.length?(h[n].shown||(h[n].shown=!0,i.show_one(h[n])),n++):clearInterval(t)},100)},this.show_one=function(i){if(!i.html)return void n(i.id);var e=this,s=t(i.html);s.find("a").on("click",function(i){i.preventDefault();var e=t(this);n(s.attr("data-id")),window.location=e.attr("href")}),t("body").append(s),s.css("top",e.get_offset()),setTimeout(function(){s.addClass("visible")},1),s.attr("data-auto-dismiss")&&(n(s.attr("data-id")),setTimeout(function(){e.dismiss(s)},s.attr("data-auto-dismiss")))},this.init(),this};window.llms=window.llms||{},window.llms.notifications=new i}(jQuery);